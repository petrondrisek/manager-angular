<section class="text-center">
    <h2 class="text-3xl font-bold">Change password</h2>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <fieldset class="form-fieldset">
            <label for="previousPassword">Previous Password</label>
            <input id="previousPassword" class="form-control" formControlName="previousPassword" type="password" placeholder="••••••••">
        </fieldset>

        <fieldset class="form-fieldset">
            <label for="newPassword">New Password</label>
            <input id="newPassword" class="form-control" formControlName="newPassword" type="password" required placeholder="••••••••">
        </fieldset>
        @if(newPassword?.invalid && (newPassword?.dirty || newPassword?.touched)) {
            @if(newPassword?.hasError('required')) {
                <p class="text-red-500">Password is required.</p>
            }

            @if(newPassword?.hasError('minlength')) {
                <p class="text-red-500">Password must be at least 8 characters long.</p>
            }

            @if(newPassword?.hasError('pattern')) {
                <p class="text-red-500">Password must contain at least one uppercase letter, one number, and one special character.</p>
            }
        }

        <fieldset class="form-fieldset">
            <label for="confirmPassword">Confirm Password</label>
            <input id="confirmPassword" class="form-control" formControlName="confirmPassword" required type="password" placeholder="••••••••">
        </fieldset>
        @if(form.hasError('passwordsMismatch')) {
            <p class="text-red-500">Passwords do not match.</p>
        }
        
        <button [disabled]="pending() || form.invalid" matButton="filled" color="primary" type="submit" class="mt-4">Set Password</button>
    </form>

    @for(error of changePasswordState()?.errors; let i = $index; track i;) {
        <p [innerHTML]="error" class="text-red-500"></p>
    }

    @if(changePasswordState()?.success) {
        <p class="text-green-500">Password changed successfully. You can leave this page now.</p>
    }
</section>